(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-136358ab"],{"236f":function(t,e,i){"use strict";var a=i("b6c5");i.n(a).a},b31a:function(t,e,i){"use strict";i.d(e,"a",function(){return o});i("d81d"),i("b680");var a=i("d4ec"),n=i("bee2"),u=(i("6cc5"),i("e11e")),o=(i("20d6"),i("5fbf"),function(){function t(){Object(a.a)(this,t)}return Object(n.a)(t,[{key:"init",value:function(t){this.map=u.map(t,{crs:u.CRS.Simple,minZoom:0,maxZoom:16,zoom:10,zoomSnap:1,zoomControl:!1,attributionControl:!1,center:[0,0]})}},{key:"drawImage",value:function(t,e){var i=new u.LatLngBounds([[t.size.y/2+t.center.y,t.size.x/2+t.center.x],[-t.size.y/2+t.center.y,-t.size.x/2+t.center.x]]);return this.map&&(e?(e.setBounds(i),e.setUrl(t.url)):e=u.imageOverlay(t.url,i,{opacity:1,zIndex:void 0!==t.zIndex?t.zIndex:1e3}).addTo(this.map)),e}},{key:"initScale",value:function(){u.Control.Scale.include({_updateMetric:function(t){var e=500*t,i=this._getRoundNum(e),a=i<500?i+" μm":i/500+" mm";this._updateScale(this._mScale,a,i/e)}}),this.map&&u.control.scale({position:"topleft",maxWidth:100,imperial:!1}).addTo(this.map)}},{key:"initToolBar",value:function(){var r=this;if(this.map){var s=new u.FeatureGroup;this.map.addLayer(s);var t={position:"topright",draw:{polyline:{shapeOptions:{color:"red",weight:5,opacity:.5},maxPoints:2,showLength:!0,metric:!0},polygon:{allowIntersection:!1,drawError:{color:"#e1e100"},shapeOptions:{color:"#bada55"}},circle:!1,rectangle:{shapeOptions:{clickable:!1}},circlemarker:!1,marker:!1},edit:{featureGroup:s}},e=new u.Control.Draw(t);this.map.addControl(e),this.map.on("draw:created",function(t){if(s.addLayer(t.layer),"polyline"===t.layerType&&r.map){var e=t.layer._latlngs[0],i=t.layer._latlngs[1],a=(e.lat+i.lat)/2,n=(e.lng+i.lng)/2,o=Math.sqrt(Math.pow(e.lat-i.lat,2)+Math.pow(e.lng-i.lng,2));u.popup({autoClose:!1,keepInView:!0,autoPan:!0}).setLatLng([a,n]).setContent("<p>".concat((1e3*o).toFixed(3)," μm</p>")).addTo(r.map)}})}}},{key:"getViewSize",value:function(){var t={x:1,y:1};return this.map&&(this.map.invalidateSize(),t={x:this.map.getSize().x,y:this.map.getSize().y}),t}},{key:"setImageFitView",value:function(t,e,i){var a=!(2<arguments.length&&void 0!==i)||i,n=this.getViewSize(),o=1;o=a?n.x/e.x:n.y/e.y,o=Math.log(o)/Math.log(2),this.map&&this.map.setView([t.y,t.x],o)}}]),t}())},b6c5:function(t,e,i){},e327:function(t,e,i){"use strict";i.r(e);i("d81d");var a=i("d4ec"),n=i("bee2"),o=i("99de"),r=i("7e84"),s=i("262e"),u=i("9ab4"),c=(i("fb6a"),i("0d03"),i("b680"),i("d3b7"),i("acd8"),i("ac1f"),i("25f0"),i("1276"),i("4795"),i("96cf"),i("1da1")),d=(i("6cc5"),i("e11e")),h=(i("20d6"),i("5fbf"),i("2de2")),m=i("784f"),p=i("90e8"),l=i("f727");function g(){return f.apply(this,arguments)}function f(){return(f=Object(c.a)(regeneratorRuntime.mark(function t(e){var i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l.a.post(h.a+"/cameracfg",e,{timeout:h.n,headers:{"Content-Type":"application/json"}});case 2:return i=t.sent,t.abrupt("return",i.data);case 4:case"end":return t.stop()}},t)}))).apply(this,arguments)}function y(){return(y=Object(c.a)(regeneratorRuntime.mark(function t(e){var i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i={action:"update",cameraPara:e},t.abrupt("return",g(i));case 2:case"end":return t.stop()}},t)}))).apply(this,arguments)}var v=i("f94a"),x=i("b31a"),w=function(){function t(){Object(a.a)(this,t),this.testMap=new x.a,this.imageBaseUrl=h.h+"/image/",this.rioBaseUrl=h.h+"/rio/",this.imageUrl="",this.imageLoadTime=0,this.imageRefreshTime=0,this.delayMs=0,this.imageSizeMm=h.f,this.imageSizePixes=h.g,this.motorPostion={x:0,y:0},this.imageCenter={x:0,y:0},this.isTouchStopped=!0,this.isTouchRuning=!1,this.lastMoveTime=0,this.mapFocusTime=0,this.timeId=0,this.isTouchLeft=!1,this.isTouchRight=!1,this.yTouchLast=0,this.isTouchLocked=!1}var e;return Object(n.a)(t,[{key:"getMotorPosition",value:(e=Object(c.a)(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v.a(["X","Y"]);case 2:void 0!==(e=t.sent).x&&void 0!==e.y&&(this.motorPostion.x=e.x,this.motorPostion.y=e.y);case 4:case"end":return t.stop()}},t,this)})),function(){return e.apply(this,arguments)})},{key:"initMap",value:function(){this.getMotorPosition(),this.imageCenter=this.motorPostion,this.map=d.map("mapid",{crs:d.CRS.Simple,minZoom:0,maxZoom:16,zoom:10,zoomSnap:0,zoomControl:!1,attributionControl:!1,center:[this.imageCenter.x,this.imageCenter.y]})}},{key:"initImage",value:function(){var t,e,i=this.imageSizeMm.x,a=this.imageSizeMm.y;t=this.motorPostion.x,e=this.motorPostion.y;var n=new d.LatLngBounds([[a/2+e,i/2+t],[-a/2+e,-i/2+t]]);if(!this.image&&this.map){var o=(new Date).getTime();this.imageUrl=this.imageBaseUrl+o.toString(),this.image=d.imageOverlay(this.imageUrl,n,{opacity:1,zIndex:100}),this.image=this.image.addTo(this.map)}if(this.map){var r=this.map.getSize(),s=0;s=r.x/r.y>i/a?Math.log(r.x/i)/Math.log(2):Math.log(r.y/a)/Math.log(2),this.map.setZoom(s)}}},{key:"initScale",value:function(){d.Control.Scale.include({_updateMetric:function(t){var e=500*t,i=this._getRoundNum(e),a=i<500?i+" μm":i/500+" mm";this._updateScale(this._mScale,a,i/e)}}),this.map&&d.control.scale({position:"topleft",maxWidth:100,imperial:!1}).addTo(this.map)}},{key:"initToolBar",value:function(){var r=this;if(this.map){var s=new d.FeatureGroup;this.map.addLayer(s);var t={position:"topright",draw:{polyline:{shapeOptions:{color:"red",weight:5,opacity:.5},maxPoints:2,showLength:!0,metric:!0},polygon:{allowIntersection:!1,drawError:{color:"#e1e100"},shapeOptions:{color:"#bada55"}},circle:!1,rectangle:{shapeOptions:{clickable:!1}},circlemarker:!1,marker:!1},edit:{featureGroup:s}},e=new d.Control.Draw(t);this.map.addControl(e),this.map.on("draw:created",function(t){if(s.addLayer(t.layer),"polyline"===t.layerType&&r.map){var e=t.layer._latlngs[0],i=t.layer._latlngs[1],a=(e.lat+i.lat)/2,n=(e.lng+i.lng)/2,o=Math.sqrt(Math.pow(e.lat-i.lat,2)+Math.pow(e.lng-i.lng,2));d.popup({autoClose:!1,keepInView:!0,autoPan:!0}).setLatLng([a,n]).setContent("<p>".concat((1e3*o).toFixed(3)," μm</p>")).addTo(r.map)}})}}},{key:"initRefreshImage",value:function(){var h=this;this.image&&this.map&&(this.image.on("load",function(t){var e=t.path[0].currentSrc.split("/"),i=e[e.length-1];e=(i=i.slice(0,i.length-4)).split("_");var a,n,o,r;r=parseFloat(e[1]),n=parseFloat(e[2]),o=parseFloat(e[3]),a=parseFloat(e[4]);var s=new d.LatLngBounds([[r,n],[o,a]]);h.image&&h.image.setBounds(s);var u=(new Date).getTime(),c=u-h.imageLoadTime;h.imageLoadTime=u,h.delayMs=h.delayMs+(200-c),h.delayMs<0&&(h.delayMs=0),h.timeId=window.setTimeout(function(){h.refreshImage()},h.delayMs)}),this.image.on("error",function(t){h.refreshImage()}))}},{key:"refreshImage",value:function(){var t=(new Date).getTime();if((t-=this.mapFocusTime)>h.i&&(this.isImageUpdate=!1),this.isImageUpdate&&this.rio&&this.image){var e=(new Date).getTime();if(this.imageRefreshTime=e,this.calNewRio(),this.rio.rioPixRange&&this.rio.rioBounds){var i=this.rioBaseUrl+this.rio.rioPixRange.west+"-"+this.rio.rioPixRange.east+"-"+this.rio.rioPixRange.north+"-"+this.rio.rioPixRange.south+"-"+this.rio.scale+"-"+e+"_"+this.rio.rioBounds.getNorth()+"_"+this.rio.rioBounds.getEast()+"_"+this.rio.rioBounds.getSouth()+"_"+this.rio.rioBounds.getWest()+".jpg";this.getMotorPosition(),this.isTouchStopped&&this.image.setUrl(i)}}}},{key:"calNewRio",value:function(){if(this.map){var t={mapZoom:this.map.getZoom(),mapBounds:this.map.getBounds(),mapCenter:this.map.getCenter()},e=this.imageSizePixes.x/this.imageSizeMm.x,i=t.mapBounds.getNorth(),a=t.mapBounds.getSouth(),n=t.mapBounds.getEast(),o=t.mapBounds.getWest(),r=this.motorPostion.y+this.imageSizeMm.y/2,s=this.motorPostion.y-this.imageSizeMm.y/2,u=this.motorPostion.x+this.imageSizeMm.x/2,c=this.motorPostion.x-this.imageSizeMm.x/2;r=r<=i?r:i,s=a<=s?s:a,u=u<=n?u:n,c=o<=c?c:o,t.rioBounds=new d.LatLngBounds([[r,u],[s,c]]),t.rioPixRange={west:Math.round((c-this.motorPostion.x)*e+this.imageSizePixes.x/2),east:Math.round((u-this.motorPostion.x)*e+this.imageSizePixes.x/2),north:Math.round((s-this.motorPostion.y)*e+this.imageSizePixes.y/2),south:Math.round((r-this.motorPostion.y)*e+this.imageSizePixes.y/2)};var h=0,m=t.mapZoom-10;h=m<=2?Math.pow(2,m-2):1,t.scale=h,this.rio=t}}},{key:"initMapAction",value:function(){var o=this;this.map&&(this.map.on("move",function(){o.isTouchStopped=!1,clearTimeout(o.timeId),o.timeId=window.setTimeout(function(){o.isTouchStopped=!0,o.refreshImage(),o.changeMotorPosition()},10)}),this.map.on("mousedown",function(t){if(o.map){var e=o.map.getSize().x;o.isTouchLeft=t.containerPoint.x<e/8,o.isTouchRight=t.containerPoint.x>7*e/8,o.isTouchLeft||o.isTouchRight?(o.yTouchLast=t.containerPoint.y,o.map.dragging.disable(),m.a.setState({isValueBarShow:!0,isShutterTimeUpdate:o.isTouchLeft,isFocusZUpdate:o.isTouchRight})):o.map.dragging.enable()}}),this.map.on("mouseup",function(t){o.map&&(o.isTouchLeft=!1,o.isTouchRight=!1,m.a.setState({isValueBarShow:!1}),o.map.dragging.enable())}),this.map.on("mousemove",function(t){if(!o.isTouchLocked){o.isTouchLocked=!0,setTimeout(function(){o.isTouchLocked=!1},100),o.isImageUpdate||(o.setMapVideoOn(!0),o.refreshImage());var e=o.yTouchLast-t.containerPoint.y;if(o.yTouchLast=t.containerPoint.y,o.isTouchLeft){var i=m.a.shutterTime+.1*e;(function(t){y.apply(this,arguments)})({imgBrightness:(i=(i=100<i?100:i)<0?0:i)*(h.l.max-h.l.min)/100+h.l.min}),m.a.setState({shutterTime:i})}if(o.isTouchRight){var a=m.a.focusZ+.1*e,n=(a=(a=100<a?100:a)<0?0:a)*(h.c.max-h.c.min)/100+h.c.min;v.b({z:n}),m.a.setState({focusZ:a})}}}),onfocus=function(){o.setMapVideoOn(!0),o.refreshImage()},onblur=function(){o.setMapVideoOn(!1)},p.b.$on(p.a.refreshMainMap,function(){o.map&&o.refreshImage()}),setTimeout(function(){var t=h.d();o.map&&1200<t-o.imageRefreshTime&&m.a.isMainMapImageUpdate&&o.refreshImage()},1e3))}},{key:"setMapVideoOn",value:function(t){t?(m.a.setState({isMainMapImageUpdate:!0}),this.mapFocusTime=(new Date).getTime(),this.isImageUpdate=!0):(this.isImageUpdate=!1,m.a.setState({isMainMapImageUpdate:!1}))}},{key:"changeMotorPosition",value:function(){if(this.map&&this.image){var t=this.map.getBounds(),e=this.imageSizeMm.x,i=this.imageSizeMm.y,a=this.imageCenter.x,n=this.imageCenter.y,o=new d.LatLngBounds([[i/2+n,e/2+a],[-i/2+n,-e/2+a]]),r=t.getNorthEast().lng,s=t.getNorthEast().lat,u=t.getSouthWest().lng,c=t.getSouthWest().lat,h=o.getNorthEast().lng,m=o.getNorthEast().lat,p=o.getSouthWest().lng,l=o.getSouthWest().lat;if(!(r<h&&s<m&&p<u&&l<c)){var g=this.map.getCenter();v.b({x:g.lng,y:g.lat})}}}},{key:"initFrewDraw",value:function(){}},{key:"isImageUpdate",get:function(){return m.a.isMainMapImageUpdate},set:function(t){m.a.setState({isMainMapImageUpdate:t})}}]),t}(),M=i("60a3"),S=i("0cc6"),b=function(t){function e(){var t;return Object(a.a)(this,e),(t=Object(o.a)(this,Object(r.a)(e).apply(this,arguments))).icon=S.a,t}return Object(s.a)(e,t),Object(n.a)(e,[{key:"hideAllBar",value:function(){m.a.setState({isAllBarHidden:!m.a.isAllBarHidden})}},{key:"mounted",value:function(){this.map=new w,this.map.initMap(),this.map.initImage(),this.map.setMapVideoOn(!0),this.map.initScale(),this.map.initToolBar(),this.map.initFrewDraw(),this.map.calNewRio(),this.map.refreshImage(),this.map.initMapAction(),this.map.initRefreshImage()}},{key:"eyeIcon",get:function(){return m.a.isAllBarHidden?this.icon.mdiEye:this.icon.mdiEyeOff}},{key:"isShow",get:function(){return!m.a.isMainMapHidden}}]),e}(M.c),T=b=Object(u.a)([M.a],b),k=(i("f411"),i("236f"),i("2877")),P=i("6544"),z=i.n(P),I=i("8336"),R=i("132d"),L=Object(k.a)(T,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.isShow,expression:"isShow"}]},[i("div",{staticClass:"map",attrs:{id:"mapid"}}),i("v-btn",{staticClass:"mr-2 show-btn",attrs:{fab:"",dark:"",small:"",color:"white"},on:{click:t.hideAllBar}},[i("v-icon",{attrs:{color:"black"}},[t._v(t._s(t.eyeIcon))])],1)],1)},[],!1,null,"8ac763b2",null);e.default=L.exports;z()(L,{VBtn:I.a,VIcon:R.a})},e99e:function(t,e,i){},f411:function(t,e,i){"use strict";var a=i("e99e");i.n(a).a},f94a:function(t,e,i){"use strict";i.d(e,"a",function(){return u}),i.d(e,"b",function(){return h}),i.d(e,"c",function(){return p}),i.d(e,"d",function(){return g});i("4160"),i("159b"),i("96cf");var a=i("1da1"),n=i("f727"),o=i("2de2");function r(){return s.apply(this,arguments)}function s(){return(s=Object(a.a)(regeneratorRuntime.mark(function t(e){var i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.a.post(o.a+"/motor",e,{timeout:o.n,headers:{"Content-Type":"application/json"}});case 2:return i=t.sent,t.abrupt("return",i.data);case 4:case"end":return t.stop()}},t)}))).apply(this,arguments)}function u(t){return c.apply(this,arguments)}function c(){return(c=Object(a.a)(regeneratorRuntime.mark(function t(e){var i,a,n,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=[],e.forEach(function(t){i.push({axis:t})}),a={action:"getPos",motorParam:i},t.next=5,r(a);case 5:return n=t.sent,o={},n.motorParam&&n.motorParam.forEach(function(t){"X"===t.axis&&(o.x=t.pos),"Y"===t.axis&&(o.y=t.pos),"Z"===t.axis&&(o.z=t.pos)}),t.abrupt("return",o);case 9:case"end":return t.stop()}},t)}))).apply(this,arguments)}function h(t){return m.apply(this,arguments)}function m(){return(m=Object(a.a)(regeneratorRuntime.mark(function t(e){var i,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=[],void 0!==e.x&&i.push({axis:"X",pos:e.x}),void 0!==e.y&&i.push({axis:"Y",pos:e.y}),void 0!==e.z&&i.push({axis:"Z",pos:e.z}),a={action:"goto",motorParam:i},t.next=7,r(a);case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}},t)}))).apply(this,arguments)}function p(t){return l.apply(this,arguments)}function l(){return(l=Object(a.a)(regeneratorRuntime.mark(function t(e){var i,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=[],void 0!==e.x&&i.push({axis:"X",pos:e.x}),void 0!==e.y&&i.push({axis:"Y",pos:e.y}),void 0!==e.z&&i.push({axis:"Z",pos:e.z}),a={action:"move",motorParam:i},t.next=7,r(a);case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}},t)}))).apply(this,arguments)}function g(t){return d.apply(this,arguments)}function d(){return(d=Object(a.a)(regeneratorRuntime.mark(function t(e){var i,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=[],void 0!==e.x&&i.push({axis:"X",param:{speed:e.x}}),void 0!==e.y&&i.push({axis:"Y",param:{speed:e.y}}),void 0!==e.z&&i.push({axis:"Z",param:{speed:e.z}}),a={action:"setParam",motorParam:i},t.next=7,r(a);case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}},t)}))).apply(this,arguments)}}}]);